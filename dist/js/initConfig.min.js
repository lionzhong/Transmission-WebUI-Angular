define(["jquery","lodash","transmission","angularAMD","angular-touch"],function(e,t,a,n){"use strict";var o=angular.module("transmission",["ngTouch"]),r=n.bootstrap(o);return r.config(["$touchProvider",function(e){e.ngClickOverrideEnabled([!0])}]),r.factory("ajaxService",["$http","$q",function(e,a){function n(t){var n=a.defer(),o=e({method:"POST",url:r+(void 0!==t.url?t.url:""),headers:void 0!==t.sessionId?{"X-Transmission-Session-Id":t.sessionId}:{},data:function(){var e={};switch(t.param.method){case"torrent-get":e=t.param;break;case"torrent-remove":e=t.param;break;default:e=t.param}return e}()});return a.when(o,function(e,t,a,o){n.resolve(e,t,a,o)},function(e,a){0!==a&&n.reject({errService:t.errService?t.errService:"Service Error",err:t.err,response:e,status:a})}),t.cancel===!0?n:n.promise}var o={},r="/transmission/rpc";o.getSession=function(e){return n({sessionId:e,param:{method:"session-get"},url:"?type=getSession"})},o.getSessionStats=function(e){return n({sessionId:e,param:{method:"session-stats"},url:"?type=getSessionStats"})};var s={all:["id"],torrentSame:["error","errorString","eta","isFinished","isStalled","leftUntilDone","metadataPercentComplete","peersConnected","peersGettingFromUs","peersSendingToUs","percentDone","queuePosition","rateDownload","rateUpload","recheckProgress","seedRatioMode","seedRatioLimit","sizeWhenDone","status","trackers","downloadDir","uploadedEver","uploadRatio","webseedsSendingToUs"],detailSame:["activityDate","corruptEver","desiredAvailable","downloadedEver","fileStats","haveUnchecked","haveValid","peers","startDate","trackerStats"]};return o.getTorrent=function(e){return n({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.torrentSame,["addedDate","name","totalSize"])}},url:"?type=getTorrent",cancel:!0})},o.getActiveTorrent=function(e){return n({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.torrentSame),ids:"recently-active"}},url:"?type=getActiveTorrent",cancel:!0})},o.getFullDetail=function(e,a){return n({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.detailSame,["comment","creator","dateCreated","files","hashString","isPrivate","pieceCount","pieceSize"]),ids:a}},url:"?type=getFullDetail",cancel:!0})},o.getDetail=function(e,a){return n({sessionId:e,param:{method:"torrent-get",arguments:{fields:t.concat(s.all,s.detailSame),ids:a}},url:"?type=getDetail",cancel:!0})},o.startTorrent=function(e){return n({sessionId:e,param:{method:"torrent-start"},url:"?type=startTorrent"})},o.stopTorrent=function(e){return n({sessionId:e,param:{method:"torrent-stop"},url:"?type=stopTorrent"})},o.removeFromList=function(e,t){return n({sessionId:e,param:{method:"torrent-remove",arguments:{ids:t}},url:"?type=removeFromList"})},o.removeAllData=function(e,t){return n({sessionId:e,param:{method:"torrent-remove",arguments:{"delete-local-data":!0,ids:t}},url:"?type=removeAllData"})},o.pauseTransform=function(e,t){return n({sessionId:e,param:{method:"torrent-stop",arguments:{ids:t}},url:"?type=torrent-stop"})},o.startTransform=function(e,t){return n({sessionId:e,param:{method:"torrent-start",arguments:{ids:t}},url:"?type=torrent-start"})},o.startTransformNow=function(e,t){return n({sessionId:e,param:{method:"torrent-start-now",arguments:{ids:t}},url:"?type=torrent-start-now"})},o}]),r.controller("mainController",["$scope","$http","$q","$sce","$timeout","ajaxService",function(n,o,r,s,i,l){var d=0,c="";n.getSession=function(e){l.getSession(e).then(function(e){n.data.global=e.data.arguments},function(e){var t=e.response.data,a="X-Transmission-Session-Id: ",o=t.indexOf(a),r=t.indexOf("</code>");if(o!==-1&&r!==-1)n.data.session=t.substring(o+(a.length-1),r),n.$emit("getSessionDone");else if(d+=1,1===d)c=(new Date).getTime();else if(5===d){var s=(new Date).getTime();c-s<=6e4?n.modal.show({type:"waring",content:"一分钟内请求Session失败次数过多，请检查网络或点击确定重新加载！",size:"small",btnType:2,submitFunc:function(){}}):d=0}})},n.getStatsData=function(){l.getSessionStats(n.data.session).then(function(e){n.data.stats=e.data.arguments,n.$emit("getStatsDone")},function(e){console.log("查询stats失败")})},n.getRecentlyActiveTorrentData=function(){n.pool.ajax.activeTorrent=l.getActiveTorrent(n.data.session),n.pool.ajax.activeTorrent.promise.then(function(e){t.each(e.data.arguments.torrents,function(e,a){var o=t.findIndex(n.data.torrent,function(t){return t.id===e.id});o>-1&&t.merge(n.data.torrent[o],e)})},function(e){console.log("查询Torrent失败")})},n.sortTorrentData=function(){return n.data.torrent=t.sortBy(n.data.torrent,function(e){return-e.addedDate}),n.data.torrent},n.loopGetTorrentData=function(){n.pool.ajax.torrent=l.getTorrent(n.data.session),n.pool.ajax.torrent.promise.then(function(e){n.data.torrent=t.sortBy(e.data.arguments.torrents,function(e){return-e.addedDate}),n.data.ids=[],t.each(n.data.torrent,function(e,t){n.data.ids.push(e.id)}),n.pool.ajax.activeTorrent=n.getRecentlyActiveTorrentData(),n.pool.loop.activeTorrent=setInterval(function(){n.getRecentlyActiveTorrentData()},n.loopFragment.torrent)},function(e){console.log("查询Torrent失败")})},n.loopGetSessionData=function(){n.getSession(n.data.session),n.pool.loop.torrent=setInterval(function(){n.getSession(n.data.session)},n.loopFragment.session)},n.selectTorrent=function(e){return e!==n.data.selectedIndex&&(n.data.selectedIndex=e,void(n.detail.status===!0&&(n.detail.close(),n.detail.show())))},n.swip={left:function(){if(n.modal.status===!0)return!1;var t=e(window).width();t<=1024&&(n.consolePanel.status===!1&&n.detail.status===!1?n.detail.show():n.consolePanel.status===!0&&n.detail.status===!1&&n.consolePanel.close())},right:function(){if(n.modal.status===!0)return!1;var t=e(window).width();t<=1024&&(n.consolePanel.status===!1&&n.detail.status===!0?n.detail.close():n.consolePanel.status===!1&&n.detail.status===!1&&n.consolePanel.show())}},n.bytesConvert=function(e){var t={data:e,band:1e3};return a.bytesConvert(t)},n.parseFloat2=function(e){return a.parseFloat2(e)},n.parsTorrentClassName=function(e,t){var a="";switch(e){case 0:a="paused";break;case 4:a="downloading";break;case 6:a="seeding";break;default:a="seeding"}return t===n.data.selectedIndex&&(a+=" selected"),a},n.parseEta=function(e){var t="";return t=e===-1?"不可用":e===-2?"无法预估":a.secondsToTime(e)},n.parseFloat2=function(e){return a.parseFloat2(e)},n.getStatusText=function(e){var t="";switch(e.status){case 0:t=e.metaComplete<1?"磁性链接下载元数据中":"已暂停";break;case 4:t="下载中";break;case 6:t="做种中"}return t},n.howLong=function(e){return n.parseEta(parseInt((new Date).getTime()/1e3)-e)},n.getFullDate=function(e){return a.parseFullDate(e)},n.parseText={Status:function(e){var t=n.data.torrent[e],a="";switch(t.status){case 0:a+="已暂停";break;case 4:a+="下载自",a+="<span>"+t.peersSendingToUs+"/"+t.peersConnected+"个用户</span>",a+='<span class="icon-download">',a+=n.bytesConvert(t.rateDownload)+"/s",a+="</span>",a+='<span class="icon-upload">',a+=n.bytesConvert(t.rateUpload)+"/s",a+="</span>";break;case 6:a+="分享至",a+="<span>"+t.peersGettingFromUs+"/"+t.peersConnected+"个用户</span>",a+='<span class="icon-upload">',a+=n.bytesConvert(t.rateUpload)+"/s",a+="</span>"}return s.trustAsHtml(a)},TransformData:function(e){var t=n.data.torrent[e],o="";switch(t.status){case 0:t.metadataPercentComplete<1?(o+="磁性链接",o+="<span>",o+="下载元数据（"+(t.metadataPercentComplete<1?a.parseFloat2(100*t.metadataPercentComplete):"100")+"%）",o+="</span>"):(o+="已下载",o+="<span>",o+=n.bytesConvert(t.totalSize*(t.percentDone<1?t.percentDone:1))+"/"+n.bytesConvert(t.totalSize),o+="</span>",o+="<span>",o+="("+(t.percentDone<1?a.parseFloat2(100*t.percentDone):"100")+"%)",o+="</span>");break;case 4:t.metadataPercentComplete<1?o+="磁性链接<span> 下载元数据（"+(t.metadataPercentComplete<1?a.parseFloat2(100*t.metadataPercentComplete):"100")+"）</span>":(o+="已下载",o+="<span>",o+=n.bytesConvert(t.totalSize*(t.percentDone<1?t.percentDone:1))+"/"+n.bytesConvert(t.totalSize),o+="</span>",o+="<span>",o+="("+(t.percentDone<1?a.parseFloat2(100*t.percentDone):"100")+"%)",o+="</span>",t.uploadedEver>0&&(o+="<span>",o+="已上传",o+="</span>",o+="<span>",o+=n.bytesConvert(t.uploadedEver),o+="</span>"),o+="<span>",o+="预估剩余时间："+n.parseEta(t.eta),o+="</span>");break;case 6:o+="已上传",o+="<span>",o+=n.bytesConvert(t.uploadedEver)+"/"+n.bytesConvert(t.totalSize),o+="</span>",o+="<span>",o+="分享率("+a.parseFloat2(t.uploadRatio)+"%)",o+="</span>",o+="<span>",o+="预估剩余时间："+n.parseEta(t.eta),o+="</span>"}return s.trustAsHtml(o)}},n.detail={target:e("#torrent-detail"),className:"show",tabNames:["info","peers","tracker","files"],tabSelect:function(e){n.detail.selectedTabIndex=e},status:!1,torrentData:!1,selectedTabIndex:0,show:function(){n.detail.status=n.detail.status!==!0,n.detail.status===!0?""!==n.data.selectedIndex&&(n.detail.torrentData=n.data.torrent[n.data.selectedIndex],n.pool.ajax.fullDetail=l.getFullDetail(n.data.session,[n.data.torrent[n.data.selectedIndex].id]),n.pool.ajax.fullDetail.promise.then(function(e){n.data.detail=e.data.arguments.torrents[0],n.pool.loop.detail=setInterval(function(){n.pool.ajax.detail=l.getDetail(n.data.session,[n.data.torrent[n.data.selectedIndex].id]),n.pool.ajax.detail.promise.then(function(e){n.data.detail=t.merge(n.data.detail,e.data.arguments.torrents[0])},function(e){console.log("维护明细数据失败")})},n.loopFragment.detail)},function(e){console.log("获取明细失败")})):n.detail.close()},close:function(){clearInterval(n.pool.loop.detail),n.detail.status=!1,n.closeAjax(n.pool.ajax.fullDetail),n.closeAjax(n.pool.ajax.detail)}},n.closeAjax=function(e){"object"==typeof e&&"function"==typeof e.resolve&&e.resolve()},n.reload={torrent:function(){clearInterval(n.pool.loop.activeTorrent),n.closeAjax(n.pool.ajax.torrent),n.closeAjax(n.pool.ajax.activeTorrent),n.loopGetTorrentData()},detail:function(){clearInterval(n.pool.loop.detail),n.closeAjax(n.pool.ajax.fullDetail),n.closeAjax(n.pool.ajax.detail)}};var u=function(t){var a=!0;return(0===n.data.torrent.length||void 0===t||0===t.length||1===t.length&&void 0===t[0])&&(a=!1),e(window).width()<=1024&&(n.consolePanel.status=!1),a};n.removeFromList=function(e){return u(e)!==!1&&void l.removeFromList(n.data.session,e).then(function(e){n.reload.torrent()},function(e){console.log("从下载列表中移除失败")})},n.removeFromList=function(e){return u(e)!==!1&&void l.removeAllData(n.data.session,e).then(function(e){n.reload.torrent()},function(e){console.log("从下载列表中移除失败")})},n.pauseTransform=function(e){return u(e)!==!1&&void l.pauseTransform(n.data.session,e).then(function(e){n.reload.torrent()},function(e){console.log("暂停传输任务请求失败！")})},n.startTransform=function(e){return u(e)!==!1&&void l.startTransform(n.data.session,e).then(function(e){n.reload.torrent()},function(e){console.log("暂停传输任务请求失败！")})},n.startTransformNow=function(e){return u(e)!==!1&&void l.startTransformNow(n.data.session,e).then(function(e){n.reload.torrent()},function(e){console.log("暂停传输任务请求失败！")})},n.consolePanel={status:!1,show:function(){n.consolePanel.status=!0},close:function(){n.consolePanel.status=!1}},n.modal={status:!1,isNeedTitle:!1,type:"add",size:"big",title:"测试标题",content:"添加传输任务失败！",btnType:2,btnText:{submit:"确定",cancel:"关闭"},submitFunc:function(){n.modal.close()},show:function(a,o){a.stopPropagation();var r="alpha";void 0!==o&&t.each(o,function(e,t){"show"!==t&&"close"!==t&&(n.modal[t]=e)}),n.modal.status=n.modal.status!==!0,i(function(){e("#modal-bg").addClass(r),e("#modal").addClass(r)},100)},close:function(){var t="alpha";e("#modal-bg").removeClass(t),e("#modal").removeClass(t),i(function(){n.modal.status=!1},550)}},e(document).click(function(){n.modal.status===!0&&n.modal.close()}),n.init=function(){if(n.loopFragment={torrent:5e3,active:5e3,detail:5e3,session:15e3},n.pool={loop:{torrent:"",activeTorrent:"",session:"",detail:""},ajax:{torrent:{},activeTorrent:{},detail:{},fullDetail:{},sessionStats:{},session:{},remove:{},add:{},pause:{}}},n.data={session:"",global:{},torrent:[],selectedIndex:"",stats:{},ids:[],detail:{}},n.localMode=!0,n.localMode===!0){var e=r.defer();require(["localData"],function(t){e.resolve(t)}),e.promise.then(function(e){n.data={global:e.global,torrent:e.torrent,selectedIndex:e.selectedIndex,stats:e.stats,ids:e.ids,detail:e.detail}},function(e){})}var t=setInterval(function(){n.getSession()},3e3);n.$on("getSessionDone",function(e){clearInterval(t),n.loopGetSessionData(),n.getStatsData()}),n.$on("getStatsDone",function(){n.loopGetTorrentData()}),n.tmpUrl={detail:"template/detail.html",blankDetail:"template/blankdetail.html",tips:"template/tips.html",settings:"template/settings.html",modal:"template/tips.html"},document.addEventListener("touchstart",function(e){e.cancelable&&(e.defaultPrevented||e.preventDefault())},!1)},n.init()}]),r.directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(e,t,a){t.replaceWith(t.children())}}}),r});
//# sourceMappingURL=maps/initConfig.min.js.map
